# Q Session Log
Last Updated: 2025-12-05T08:34:00.000-07:00

## PURPOSE
Track recent commands and context to recover from context window overflows.

## CURRENT SESSION SUMMARY
- **Working on**: Fixed Pac-Man speed configuration issue
- **Latest changes**: 
  - **IMPLEMENTED**: Ghost speed scaling with player speed while maintaining individual personalities
  - **REVERTED**: Previous change that made ghosts exactly same speed as Pac-Man
  - **FORMULA**: Ghost delay = `(config.ghosts.speed) / (player.speed * ghostSpeedMultiplier)`
  - **PERSONALITIES**: Vulnerable ghosts move at 0.5x speed, normal ghosts at 1.0x speed
  - **SCALING**: When player speed changes, ghost speeds automatically scale proportionally
  - **UPDATED**: Ghost speed to match Pac-Man speed for balanced gameplay
  - **CHANGED**: Ghost movement from fixed delay system to same speed increment as Pac-Man
- **Previous changes**: 
  - **REFACTORED**: Question system to use ordered arrays instead of ID-based matching
  - **ADDED**: 14 difficult Bible trivia questions requiring research and lookup
  - **IMPLEMENTED**: Question encryption system to prevent casual browsing
  - **CREATED**: Encryption/decryption utilities for development workflow
  - **ENHANCED**: Final math question using clever sorted position calculations
- **Key improvements**:
  - Pac-Man speed now properly responds to configuration changes via game settings UI
  - Both fallback config and runtime config use consistent `player.speed` property
  - Questions use ordered arrays - game N uses answer[N-1] to unlock, shows question[N] when completed
  - All 14 questions have unique numeric answers spanning Old and New Testament
  - Questions encrypted in questions.enc file, decrypted at runtime
- **Status**: Pac-Man speed configuration fixed and ready for testing

## ENCRYPTION WORKFLOW
**To update questions:**
1. Run `node encrypt-questions.js` to create questions.json from encrypted file
2. Edit questions.json with new content
3. Run `node encrypt-questions.js` again to update questions.enc
4. Delete questions.json (it's in .gitignore)
5. Commit and push questions.enc

**Files:**
- `questions.enc` - Encrypted questions file (committed to git)
- `questions.json` - Temporary decrypted file for editing (gitignored)
- `encrypt-questions.js` - Utility script for encryption/decryption (gitignored)
- `.gitignore` - Prevents accidental commit of decrypted files

## RECENT COMMANDS (Last 10)
1. `node -c ./games/pacman/src/pacman.js` - Verified syntax after ghost speed scaling implementation
2. Updated fallback config to use `ghosts.speed` instead of `normalSpeed/vulnerableSpeed`
3. Implemented ghost speed scaling formula: `(ghosts.speed) / (player.speed * ghostSpeedMultiplier)`
4. Added vulnerable ghost speed multiplier (0.5x) vs normal ghosts (1.0x)
5. Reverted ghost speed to delay-based system but with player speed scaling
6. `node -c ./games/pacman/src/pacman.js` - Verified syntax after ghost speed change
7. Updated ghost speed to match Pac-Man speed using `pacmanConfig.player.speed` increment
8. Fixed syntax error by adding proper closing brace for ghost speed if statement
9. Changed ghost movement from delay-based system to same timer system as Pac-Man
10. `node -c ./games/pacman/src/pacman.js` - Verified syntax after speed configuration fix

## TESTING INSTRUCTIONS FOR PAC-MAN SPEED FIX
**Prerequisites:**
1. Game should load normally with current configuration
2. Configuration UI should be accessible via debug mode (add `?gubed` to URL)

**Test Steps:**
1. **Access Configuration:**
   - Add `?gubed` to URL to enable debug mode
   - Click ⚙️ Configuration button
   - Switch to "Game" tab
   - Select "Pac-Man" from dropdown

2. **Test Speed Configuration:**
   - Note current player speed value (should be 0.66)
   - Change player speed to a different value (e.g., 0.2 for slower, 1.0 for faster)
   - Click "Save Changes"
   - Close configuration modal

3. **Verify Speed Change:**
   - Start Pac-Man game from level selection
   - Use arrow keys to move Pac-Man
   - Verify movement speed matches the configured value
   - Lower values = slower movement, higher values = faster movement

4. **Test Multiple Values:**
   - Try speed values: 0.1 (very slow), 0.5 (medium), 1.5 (fast)
   - Each change should be immediately noticeable in gameplay
   - Movement should be smooth and responsive at all speeds

5. **Reset Test:**
   - Open configuration again
   - Click "Reset to Defaults" 
   - Verify speed returns to default value (0.66)
   - Test that default speed works correctly

**Expected Results:**
- Configuration changes should immediately affect Pac-Man movement speed
- No console errors when changing speed values
- Game should remain playable at all reasonable speed values
- Speed changes should persist until reset or changed again

**Issue Resolution:**
- **Problem**: Game was looking for `player.moveSpeed` but config had `player.speed`
- **Solution**: Updated game code to use correct config property name
- **Files Changed**: `./games/pacman/src/pacman.js` (lines 18 and 207)

## NEW LEARNINGS - GITHUB PAGES DEPLOYMENT
- **Path Resolution**: GitHub Pages requires `./games/` prefix for asset paths
- **Canvas Scaling**: Must set both canvas properties AND CSS styles to prevent coordinate system issues
- **Asset Loading**: Working pattern is `./games/[gamename]/[asset]?v=${Date.now()}`
- **Testing Required**: Always test both local development AND GitHub Pages deployment
- **Cross-Reference**: Compare working games (Mario) with broken games (Donkey Kong) to identify patterns

## TESTING INSTRUCTIONS FOR QUESTION SYSTEM
**Prerequisites:**
1. Game should load normally with encrypted questions
2. Questions should decrypt seamlessly at runtime

**Test Steps:**
1. **Basic Functionality:**
   - Complete Level 1 - should show first question
   - Try to access Level 2 - should require answer from Level 1's question
   - Verify all 15 levels work with proper question/answer flow

2. **Question Content:**
   - All questions should be difficult Bible trivia requiring research
   - Each question should have unique numeric answer
   - Final question should use mathematical calculation with sorted positions

3. **Encryption Security:**
   - Browse git repository - should only see questions.enc (encrypted)
   - questions.json should not be in git history
   - Game should load questions normally despite encryption

4. **Development Workflow:**
   - Run `node encrypt-questions.js` to create questions.json
   - Edit questions.json
   - Run script again to update questions.enc
   - Verify changes appear in game

## IMPORTANT WORKFLOW CHANGE
- **DO NOT automatically push to git** - wait for explicit user instructions
- **ALWAYS provide comprehensive testing instructions** for new features
- **UPDATE q/* files** when discovering new patterns or system requirements
- **FOLLOW all instructions** in q/startup.txt and related files
- **USE encryption workflow** when updating questions

## ACTIVE CONTEXT
- **Working directory**: /Users/P2176038/Desktop/greg
- **Current branch**: main
- **Project**: Arcade games collection with encrypted Bible trivia question system
- **Focus**: Difficult Bible trivia with encryption for security
- **Next**: Ready for testing encrypted question system or additional enhancements

## RECOVERY INSTRUCTIONS
If context overflows, user has implemented comprehensive question system refactor with encryption. Questions use ordered arrays where game N requires answer[N-1] to unlock and shows question[N] when completed. All questions are difficult Bible trivia with unique numeric answers, encrypted in questions.enc file. Use encrypt-questions.js utility to update questions. System includes bypass feature for development and proper game/question flow management.
